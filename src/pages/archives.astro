---
import MainPageLayout from '@layouts/MainPageLayout.astro'
import Cover from '@components/Cover.astro'

import { siteConfig } from '@/config'
import { formatDateToArchive } from '@utils/url-utils'
import { getBlogEntrySort } from '@utils/content-utils'

import { getCollection } from 'astro:content'

// 获取所有博客文章并按发布日期降序排序
const allBlogPosts = await getBlogEntrySort();


// 按年份分组文章
const postsByYear = allBlogPosts.reduce((acc, post) => {
  const year = post.data.pubDate.getFullYear();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof allBlogPosts>);

const pageTitle = "归档 - " + siteConfig.title;
---

<MainPageLayout title={pageTitle}>
    <div class="archives mx-auto w-full max-w-[min(494px,90%)]">
        <Cover title='文章归档' subTitle={`共 ${allBlogPosts.length} 篇文章`}/>
        
        <div class="p-6 max-w-2xl mx-auto">
            {Object.keys(postsByYear).sort().reverse().map(year => (
                <div>
                    <h2 class="text-2xl font-bold my-4">{year}</h2>
                    <div class="">
                            {postsByYear[Number(year)].map((post, index, array) => (
                                <div class="flex items-start gap-4 group">
                                    <div class="flex flex-col items-center flex-shrink-0 relative" style="width: 8px;">
                                        {index !== 0 && <div class="absolute top-0 w-px h-1/2 bg-gray-300" style="left: 50%; transform: translateX(-50%);"></div>}
                                        <div class="w-2 h-2 rounded-full bg-gray-400 mt-5 mb-5 z-10"></div>
                                        {index !== array.length - 1 && <div class="absolute bottom-0 w-px h-1/2 bg-gray-300" style="left: 50%; transform: translateX(-50%);"></div>}
                                    </div>
                                    <div class="flex-1 py-3">
                                        <span class="text-sm text-gray-400 mr-3">{formatDateToArchive(post.data.pubDate)}</span>
                                        <a href={`/blog/${post.id}`} class="">
                                        {post.data.title}
                                    </a>
                                    </div>
                                </div>
                            ))}
                    </div>
                </div>
            ))}
        </div>
    </div>
</MainPageLayout>

<style>
   .archives a {
        /* transition: color 0.3s ease; */
        text-decoration: none;
        position: relative;
        display: inline-block;
    }
    
    .archives a::before {
        content: "";
        position: absolute;
        bottom: 1px;
        left: 0;
        width: 100%;
        border-bottom-style: dotted;
        border-bottom-width: 2px;
        /* background: currentColor; */
        transition: transform 0.3s ease;
        transform-origin: right;
        transform: scaleX(1);
    }
    
    .archives a:hover {
        color: var(--link-color);
    }
    
    .archives a:hover::before {
        transform-origin: right;
        transform: scaleX(0);
    }
</style>